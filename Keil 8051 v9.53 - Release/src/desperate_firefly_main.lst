C51 COMPILER V9.53.0.0   DESPERATE_FIREFLY_MAIN                                            12/03/2017 12:45:30 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE DESPERATE_FIREFLY_MAIN
OBJECT MODULE PLACED IN .\src\desperate_firefly_main.OBJ
COMPILER INVOKED BY: c:\SiliconLabs\SimplicityStudio\v4\developer\toolchains\keil_8051\9.53\BIN\C51.exe C:\Users\Jacques
                    -\SimplicityStudio\v4_workspace\desperate_firefly\src\desperate_firefly_main.c OMF2 SMALL DEBUG OBJECTEXTEND ROM(LARGE) W
                    -ARNINGLEVEL(2) FLOATFUZZY(3) OPTIMIZE(9,SPEED) DEFINE(NDEBUG=1) INTVECTOR(0X0000) INTPROMOTE INCDIR(C:\Users\Jacques\Sim
                    -plicityStudio\v4_workspace\desperate_firefly\inc;C:/SiliconLabs/SimplicityStudio/v4/developer/sdks/8051/v4.0.8//Device/s
                    -hared/si8051base;C:/SiliconLabs/SimplicityStudio/v4/developer/sdks/8051/v4.0.8//Device/EFM8BB1/inc) REGFILE(desperate_fi
                    -refly.ORC) PRINT(.\src\desperate_firefly_main.lst) COND CODE PAGEWIDTH(120) PAGELENGTH(65) OBJECT(.\src\desperate_firefl
                    -y_main.OBJ)

line level    source

   1          //=========================================================
   2          // src/desperate_firefly_main.c: generated by Hardware Configurator
   3          //
   4          // This file will be updated when saving a document.
   5          // leave the sections inside the "$[...]" comment tags alone
   6          // or they will be overwritten!!
   7          //=========================================================
   8          
   9          //-----------------------------------------------------------------------------
  10          // Includes
  11          //-----------------------------------------------------------------------------
  12          #include <SI_EFM8BB1_Register_Enums.h>                  // SFR declarations
  13          #include "InitDevice.h"
  14          // $[Generated Includes]
  15          // [Generated Includes]$
  16          
  17          //-----------------------------------------------------------------------------
  18          // SiLabs_Startup() Routine
  19          // ----------------------------------------------------------------------------
  20          // This function is called immediately after reset, before the initialization
  21          // code is run in SILABS_STARTUP.A51 (which runs before main() ). This is a
  22          // useful place to disable the watchdog timer, which is enable by default
  23          // and may trigger before main() in some instances.
  24          //-----------------------------------------------------------------------------
  25          void SiLabs_Startup (void)
  26          {  //disable watchdog timer
  27   1         WDTCN = 0xDE; //First key
  28   1         WDTCN = 0xAD; //Second key
  29   1      }
  30          
  31          void hardware_config(void){
  32   1              // LED connected to Port 1 pin 3. i.e. P1.3
  33   1              //reduce port 1 drive strength
  34   1              PRTDRV&=~(PRTDRV_P1DRV__BMASK);
  35   1              //Port 1 pin 3 output mode open drain
  36   1              P1MDOUT&=~(P1MDOUT_B3__BMASK);
  37   1              // enable crossbar with weak pull up disabled
  38   1              XBR2=XBR2_XBARE__ENABLED|XBR2_WEAKPUD__BMASK;
  39   1              // configure system clock
  40   1              // System clock can be drop as low as 78,125 Hertz with appropriate settings of LFO0CN and CLKSEL registe
             -rs.
  41   1              // first enable Low Frequency Oscillator with output divided by 8.
  42   1              LFO0CN=LFO0CN_OSCLEN__ENABLED|LFO0CN_OSCLD__DIVIDE_BY_8;
  43   1              // wait for oscillator ready bit.
  44   1              while ((LFO0CN&LFO0CN_OSCLRDY__SET)==0);
  45   1              // select LFO as system clock and divide that frequency again by 32
  46   1              // system clock is 80Khz/8/32=312,5 Hertz
  47   1              // T=1/Fsys=3,2msec
  48   1              CLKSEL=CLKSEL_CLKDIV__SYSCLK_DIV_32|CLKSEL_CLKSL__LFOSC;
  49   1      
C51 COMPILER V9.53.0.0   DESPERATE_FIREFLY_MAIN                                            12/03/2017 12:45:30 PAGE 2   

  50   1      }
  51          // bit pattern to generate SOS morse code: dit,dit,dit,dah,dah,dah,dit,dit,dit
  52          const char sos[4]={0xab,0xbb,0xaa,0};
  53          
  54          
  55          
  56          //-----------------------------------------------------------------------------
  57          // main() Routine
  58          // ----------------------------------------------------------------------------
  59          int main (void)
  60          {
  61   1              unsigned char b,c;
  62   1      
  63   1      // Call hardware initialization routine
  64   1        enter_DefaultMode_from_RESET();
  65   1        hardware_config();
  66   1        b=0;
  67   1        while (1) 
  68   1        {
  69   2              c=sos[b/8]&(1<<(7-b%8));
  70   2          b++;
  71   2          if (b==28) b=0;
  72   2              if (c)
  73   2                      P1&=~(1<<3); // port 1 pin 3 latch low LED ON
  74   2              else
  75   2                      P1|=(1<<3); // port 1 pin 3 latch high  LED OFF
  76   2        }
  77   1      
  78   1      }
C51 COMPILER V9.53.0.0   DESPERATE_FIREFLY_MAIN                                            12/03/2017 12:45:30 PAGE 3   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION SiLabs_Startup (BEGIN)
                                           ; SOURCE LINE # 25
                                           ; SOURCE LINE # 26
                                           ; SOURCE LINE # 27
0000 7597DE            MOV     WDTCN,#0DEH
                                           ; SOURCE LINE # 28
0003 7597AD            MOV     WDTCN,#0ADH
                                           ; SOURCE LINE # 29
0006 22                RET     
             ; FUNCTION SiLabs_Startup (END)

             ; FUNCTION hardware_config (BEGIN)
                                           ; SOURCE LINE # 31
                                           ; SOURCE LINE # 34
0000 53F6FD            ANL     PRTDRV,#0FDH
                                           ; SOURCE LINE # 36
0003 53A5F7            ANL     P1MDOUT,#0F7H
                                           ; SOURCE LINE # 38
0006 75E3C0            MOV     XBR2,#0C0H
                                           ; SOURCE LINE # 42
0009 75B180            MOV     LFO0CN,#080H
000C         ?C0002:
                                           ; SOURCE LINE # 44
000C E5B1              MOV     A,LFO0CN
000E 30E6FB            JNB     ACC.6,?C0002
0011         ?C0003:
                                           ; SOURCE LINE # 48
0011 75A952            MOV     CLKSEL,#052H
                                           ; SOURCE LINE # 50
0014 22                RET     
             ; FUNCTION hardware_config (END)

             ; FUNCTION main (BEGIN)
                                           ; SOURCE LINE # 59
                                           ; SOURCE LINE # 60
                                           ; SOURCE LINE # 64
0000 120000      E     LCALL   enter_DefaultMode_from_RESET
                                           ; SOURCE LINE # 65
0003 120000      R     LCALL   hardware_config
                                           ; SOURCE LINE # 66
;---- Variable 'b' assigned to Register 'R7' ----
0006 E4                CLR     A
0007 FF                MOV     R7,A
0008         ?C0005:
                                           ; SOURCE LINE # 67
                                           ; SOURCE LINE # 68
                                           ; SOURCE LINE # 69
0008 EF                MOV     A,R7
0009 5407              ANL     A,#07H
000B FE                MOV     R6,A
000C C3                CLR     C
000D 7407              MOV     A,#07H
000F 9E                SUBB    A,R6
0010 FE                MOV     R6,A
0011 7401              MOV     A,#01H
0013 A806              MOV     R0,AR6
0015 08                INC     R0
0016 8002              SJMP    ?C0012
0018         ?C0011:
0018 C3                CLR     C
C51 COMPILER V9.53.0.0   DESPERATE_FIREFLY_MAIN                                            12/03/2017 12:45:30 PAGE 4   

0019 33                RLC     A
001A         ?C0012:
001A D8FC              DJNZ    R0,?C0011
001C FE                MOV     R6,A
001D EF                MOV     A,R7
001E 13                RRC     A
001F 13                RRC     A
0020 13                RRC     A
0021 541F              ANL     A,#01FH
0023 2400        R     ADD     A,#LOW sos
0025 F8                MOV     R0,A
0026 E6                MOV     A,@R0
0027 5E                ANL     A,R6
0028 FE                MOV     R6,A
;---- Variable 'c' assigned to Register 'R6' ----
                                           ; SOURCE LINE # 70
0029 0F                INC     R7
                                           ; SOURCE LINE # 71
002A BF1C02            CJNE    R7,#01CH,?C0007
002D E4                CLR     A
002E FF                MOV     R7,A
002F         ?C0007:
                                           ; SOURCE LINE # 72
002F EE                MOV     A,R6
0030 6005              JZ      ?C0008
                                           ; SOURCE LINE # 73
0032 5390F7            ANL     P1,#0F7H
0035 80D1              SJMP    ?C0005
0037         ?C0008:
                                           ; SOURCE LINE # 75
0037 439008            ORL     P1,#08H
                                           ; SOURCE LINE # 76
003A 80CC              SJMP    ?C0005
             ; FUNCTION main (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     88    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
